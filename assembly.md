# 汇编语言

## X86

##### 一、基础知识

###### 机器语言

- 通过纸带机或卡片机输入0-1代码
  - 冗长
  - 繁琐
  - 易出错
  - 不易读

###### 汇编语言产生

- 通过汇编指令编写程序
  - 便捷，相对高效
  - 编写的指令通过编译器转码成机器码、执行
- 汇编语言指令类型
  - 汇编指令：机器码的助记符，有相应的机器码（核心）
  - 伪指令：没有对应的机器码，由编译器执行
  - 其他符号：+、-、*、/等等，由编译器识别

###### 存储器

- CPU读取内存
- CPU读取、运算
- CPU写入内存

###### 指令和数据

- 应用上的概念
- 在内存或磁盘上，指令和数据没有区别

###### 存储单元

- 存储器被划分为若干单元
- 通常来说，一个存储单元存储1Byte（8bit）
  - 对存储元件：1KB=1024B，1MB=1024KB，1GB=1024MB，1TB=1024GB
  - 对于带宽 通常1Kb=1000bits ...

###### CPU对存储器的读写

- 实现读写
  - 存储单元的地址（地址信息）
  - 器件的选择，读或写的命令（控制信息）
  - 读或写的数据（数据信息）

###### 地址总线

- 地址总线数（N）决定了CPU寻址能力
- 寻址单元数（$2^N$）

<img src="/Users/alpha/Library/Application Support/typora-user-images/image-20230425221719557.png" alt="image-20230425221719557" style="zoom:25%;" />

###### 数据总线

- 数据总线的宽度决定了CPU与其他器件的每次数据传输量（传输速度）（N <---> N）
- 当宽度小于数据量时，分段传输

###### 控制总线

- 控制总线的数量决定了CPU对外部器件的控制能力

###### 主板

- 主板是CPU等核心器件与其他器件相连的通道
- CPU、存储器、外围芯片组、拓展卡槽（RAM内存条、各类接口卡）等

###### 接口卡

- CPU通过接口卡对I/O设备进行控制
- CPU和接口卡通过总线相连，实现CPU对其间接控制

###### 各类存储器芯片

- 随机存储器RAM（Random Access Memory）
  - 用于存放CPU的绝大部分程序和数据
  - 一般由主板上的RAM和扩展槽上的RAM组成
    - 典型的卡槽上的RAM有显存，应对大批量输入、输出数据的高速缓存
- 只读存储器ROM（Read Only Memory）
  - BIOS（Basic Input/Output System），由主板和各类接口卡厂商提供的软件系统，实现基本的输入输出

<img src="/Users/alpha/Library/Application Support/typora-user-images/image-20230425223451613.png" alt="image-20230425223451613" style="zoom:25%;" />

###### 内存地址空间

- 存储器在被CPU操控时被视为一个由若干单元组成的逻辑存储器
- 逻辑存储器即内存地址空间（Imaginational）
  - 不同的计算机的内存地址空间的分配不同（即主存储器、显存、各类ROM的大小空间是不同的）

<img src="/Users/alpha/Library/Application Support/typora-user-images/image-20230425223756909.png" alt="image-20230425223756909" style="zoom:25%;" />



##### 二、寄存器

###### 通用寄存器

- 8086CPU的所有寄存器都是16位的，可以存放两个字节
- AX、BX、CX、DX通常用来存放一般性的数据，即通用寄存器
- 为了向下兼容
  - AX、BX、CX、DX可以分为高位、低位，即AH、AL等

###### 字在寄存器中的存储

- 同样由于向下兼容，8086CPU可以一次处理两种尺寸数据
  - 字节：1 byte（8bit）
  - 字：1 word （16bit）高字节和低字节位对应AH、AL

###### 几条简单的汇编指令

| 汇编指令  | 控制CPU完成的操作            | 高级语言描述 |
| --------- | ---------------------------- | ------------ |
| MOV AX,18 | 将18存入寄存器AX             | AX=18        |
| MOV AH,78 | 将78送进寄存器AH             | AH=78        |
| ADD AX,8  | 将寄存器AX中的数值加8        | AX=AX+8      |
| MOV AX,BX | 将寄存器BX中的数据送入AX     | AX = BX      |
| ADD AX,BX | 将AX和BX中的数值相加，存入AX | AX=AX+BX     |

- 一般来说汇编语言使用的数值偏向于16进制，便于表示

###### 物理地址

- 每个内存单元对应存储器中的唯一地址（线性的）
- 不同的CPU可以有不同的形成物理地址的方式

###### 16位结构的CPU

- 运算器一次处理16位数据
- 寄存器最大宽度16位
- 寄存器与运算器之间的通路16位

###### 8086CPU的地址映射方式

- 8086CPU有20位地址总线

- 采用16位段地址和16位偏移地址

  - 通过$段地址\times16+偏移地址$来映射物理地址

    <img src="/Users/alpha/Library/Application Support/typora-user-images/image-20230425230113357.png" alt="image-20230425230113357" style="zoom:25%;" />

###### 段的概念

- 根据需要，在编程时虚设的概念

###### 段寄存器

- 8086CPU有四个段寄存器
- **CS、DS、SS、ES**
- CS：IP是8086CPU中最关键的寄存器
  - CS为代码段寄存器
  - IP为指令指针寄存器
  - CS（data：M），IP（data：N）
    - CPU将从$M\times16+N$开始读取一条指令并执行
    - CPU将CS：IP指向的内容当作指令执行
    - 执行完一条指令IP**自动加上执行指令长度**以实现跳转到下一条指令
  - 8086CPU开机后，CPU从FFFF0H单元读取第一条指令并执行

###### 修改CS、IP的指令

- 指令：

  ```assembly
  JMP  CS:IP 
  ```

- 须是合法的寄存器

- JMP指令类似于C语言中的```goto()```易引起错乱、死循环等

###### 代码段

- 根据需要，可将一组内存单元定义为一个段

  ```assembly
  MOV AX,0000H
  ADD AX,0123H
  MOV BX,AX
  JMP BX
  ```

  - 此段长度为10Byte的指令，存放在123B0H～123B9H的一组内存单元，即为代码段



##### 三、寄存器（内存访问）

###### 内存中字的存储

- 用0、1号单元存储一个字
  - 高位放在1，低位放在0（小端）
- 字单元，即存储一个字的两个内存单元

###### **DS** 和 **[address]**

- DS寄存器通常用来存放**即将访问数据的段地址**
- 而[address]（如[0]）表示一个内存单元，其中的address（' 0 '）表示内存单元的偏移地址
  - "[ ]"说明操作对象是一个内存单元，"address"表示内存单元的**偏移地址**是'address'

- 在执行指令时，CPU自动取DS中的数据作为段地址
- 另外，8086CPU不支持直接将数据送入段寄存器的操作（可能是硬件层面问题，[见知乎大佬的回答](https://www.zhihu.com/question/43608287)）

###### 字的传送

- 8086CPU数据总线宽度为16位，一次可传送16个bit，即一个字

###### MOV、ADD、SUB指令

- mov     register,                    data

  ```assembly
  mov ax ,8
  ```

- mov     register,                    register

  ```assembly
  mov ax,bx
  ```

- mov     register,                    memory-unit

  ```assembly
  mov ax,[0]
  ```

- mov     memory-unit,            register

  ```assembly
  mov [0],ax
  ```

- mov     segment-register,     register

  ```assembly
  mov ds,ax
  ```

- add和sub 与mov指令一样

  - [ ] add ds,ax?

- 上述指令对register来说是双向的

###### 数据段



###### 栈

###### CPU提供的栈机制

###### 栈顶超界问题

###### PUSH、POP指令

###### 栈段

























##### 第一个程序

##### [BX]和loop指令

##### 多段程序

##### 定位内存的方法

##### 数据处理的两个基本问题

##### 转移指令

##### CALL和RET指令

##### 标志寄存器

##### 内中断

##### int指令

##### 端口

##### 外中断

##### 直接定址表

##### 使用BIOS进行键盘输入和磁盘读写

